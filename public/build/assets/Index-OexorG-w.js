import{o as C,a as F,j as Y,k as Q,b as o,x as g,e as h,c as x,F as z,y as U,z as O,I as G,r as f,A as H}from"./app-sYwY5Q9E.js";import{_ as K}from"./DisplayLayout-BWhLaTvW.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";let k=[],_=!1;const d="/audio",y=new Map,A=s=>{if(y.has(s))return y.get(s).promise;const e=new Audio(s);e.preload="auto";let l;const t=new Promise(m=>{l=m}),i=()=>{e.removeEventListener("canplaythrough",p),e.removeEventListener("error",u)},p=()=>{i(),l(!0)},u=()=>{i(),l(!1)};return e.addEventListener("canplaythrough",p,{once:!0}),e.addEventListener("error",u,{once:!0}),e.load(),y.set(s,{element:e,promise:t}),t},Z=async()=>{const s=new Set;s.add(`${d}/tone/ding.mp3`),s.add(`${d}/frasa/nomor_antrian.mp3`),s.add(`${d}/frasa/silakan_menuju.mp3`),s.add(`${d}/frasa/loket.mp3`);for(let t=0;t<=9;t++)s.add(`${d}/angka/${t}.mp3`);"abcdefghijklmnopqrstuvwxyz".split("").forEach(t=>s.add(`${d}/huruf/${t}.mp3`));const e=Array.from(s).map(t=>A(t).catch(()=>!1)),l=new Promise(t=>setTimeout(t,2e3,"timeout"));await Promise.race([Promise.all(e),l])},W=({prefix:s,number:e,counter:l})=>{const t=[];return t.push(`${d}/tone/ding.mp3`),t.push(`${d}/frasa/nomor_antrian.mp3`),s&&t.push(`${d}/huruf/${s.toLowerCase()}.mp3`),e&&e.toString().split("").forEach(i=>{t.push(`${d}/angka/${i}.mp3`)}),t.push(`${d}/frasa/silakan_menuju.mp3`),t.push(`${d}/frasa/loket.mp3`),l&&t.push(`${d}/angka/${l}.mp3`),t},D=(s,e)=>{if(s.length===0){e();return}const l=s.shift(),t=y.get(l);let i;if(t&&t.element)try{i=t.element.cloneNode(!0)}catch{i=new Audio(l),i.preload="auto"}else{i=new Audio(l),i.preload="auto";try{i.load()}catch{}}const p=()=>D(s,e);i.onended=p,i.onerror=p,i.play().catch(u=>{console.error("Gagal memutar audio:",l,u),p()})},P=()=>{if(_||k.length===0)return;_=!0;const{data:s,onFinish:e}=k.shift(),l=W(s);A(l[0]).catch(()=>{}),l[1]&&A(l[1]).catch(()=>{}),D(l,()=>{e&&e(),_=!1,P()})},X=(s,e=null)=>{k.push({data:s,onFinish:e}),P()},q={class:"w-full h-full flex bg-gray-50"},ee={class:"w-[55%] flex flex-col p-6 gap-6 justify-center"},te={class:"bg-[#ffc107] rounded-[30px] border-[12px] border-[#00569c] shadow-2xl p-8 relative flex items-center justify-between h-[400px]"},ae={class:"flex flex-col items-start pl-4"},oe={class:"text-[12rem] leading-none font-black text-[#00569c] font-mono tracking-tighter drop-shadow-md"},ne={class:"flex flex-col items-center pr-4"},se={class:"bg-[#00569c] text-white p-8 rounded-[25px] flex flex-col items-center min-w-[200px] shadow-xl border-4 border-white/20"},le={class:"text-8xl font-black leading-none"},re={class:"bg-white rounded-[25px] shadow-xl border-2 border-gray-100 flex flex-col overflow-hidden h-[240px]"},ie={class:"flex-1 p-6 flex gap-6 items-center justify-center"},ce={class:"text-6xl font-black text-[#00569c] font-mono mb-1"},de={class:"text-sm font-bold text-gray-500 uppercase"},ue={key:1,class:"text-gray-400 italic font-bold"},pe={key:0,class:"fixed inset-0 bg-[#00569c]/95 backdrop-blur-xl flex items-center justify-center z-50"},fe={class:"text-center"},me={class:"mb-10 transform scale-125"},ve={class:"bg-white p-6 rounded-[30px] inline-block mb-4 shadow-2xl border-4 border-yellow-400"},he="h_7SSTIn88E",ge={__name:"Index",setup(s){const e=f(null),l=f("vHZhFmkINI8"),t=f(!1),i=f([]),p=f(new Map),u=f(!1),m=f(null),w=f([]),b=f(!1);let I=!0,E=null,S=null;const T=()=>{if(e.value&&typeof e.value.destroy=="function")try{e.value.destroy()}catch(a){console.error(a)}e.value=new YT.Player("youtube-player",{videoId:l.value,playerVars:{autoplay:1,controls:0,rel:0,loop:1,playlist:l.value,playsinline:1,origin:window.location.origin},events:{onReady:a=>{a.target.setVolume(100),a.target.mute(),u.value&&(a.target.unMute(),a.target.playVideo())},onStateChange:a=>{a.data===YT.PlayerState.ENDED&&!t.value&&e.value.playVideo()}}})},B=()=>{if(window.YT&&window.YT.Player)T();else if(window.onYouTubeIframeAPIReady=T,!document.querySelector('script[src="https://www.youtube.com/iframe_api"]')){const a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";const n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)}},L=()=>{const a=new Date,n=a.getDay(),r=a.getHours(),c=a.getMinutes(),v=a.getSeconds();n>=1&&n<=5&&r===10&&c===0&&v===0&&!t.value&&e.value&&typeof e.value.loadVideoById=="function"&&(t.value=!0,e.value.loadVideoById(he),e.value.unMute(),e.value.setVolume(100),e.value.playVideo(),setTimeout(()=>{e.value.loadVideoById(l.value),t.value=!1},135e3))},N=()=>{if(w.value.length===0){b.value=!1,e.value&&typeof e.value.setVolume=="function"&&e.value.setVolume(100);return}b.value=!0,e.value&&typeof e.value.setVolume=="function"&&e.value.setVolume(10);const a=w.value.shift();m.value=a.originalData,X(a.announcement,()=>{N()})},V=async()=>{try{const{data:a}=await G.get("/display/data");if(i.value=a,!a.length||!u.value)return;if(I){a.forEach(r=>p.value.set(r.id,r.updated_at)),I=!1;return}const n=[];a.forEach(r=>{const c=p.value.get(r.id);(!c||r.updated_at>c)&&r.status==="called"&&(n.push(r),p.value.set(r.id,r.updated_at))}),n.length>0&&(n.sort((r,c)=>new Date(r.updated_at)-new Date(c.updated_at)),n.forEach(r=>{const c=r.ticket_code||r.number||"000",v=isNaN(c.charAt(0))?c.charAt(0):"",j=c.replace(/\D/g,""),R=parseInt(j,10).toString();w.value.push({announcement:{prefix:v,number:R,counter:r.counter?r.counter.name.replace(/\D/g,""):"1"},originalData:r})}),b.value||N())}catch(a){console.error("Gagal koneksi server",a)}},M=()=>{u.value=!0,new Audio().play().catch(()=>{}),e.value&&typeof e.value.unMute=="function"&&(e.value.unMute(),e.value.setVolume(100),e.value.playVideo()),document.documentElement.requestFullscreen().catch(()=>{})},$=H(()=>i.value.filter(a=>a.status==="waiting").slice(0,3));return C(()=>{Z().catch(()=>{}),B(),V(),E=setInterval(V,3e3),S=setInterval(L,1e3)}),F(()=>{clearInterval(E),clearInterval(S)}),(a,n)=>(h(),Y(K,{title:"Display Antrian ASABRI"},{default:Q(()=>{var r;return[o("div",q,[o("div",ee,[o("div",te,[o("div",ae,[n[1]||(n[1]=o("h2",{class:"text-2xl font-black text-[#00569c] uppercase tracking-widest mb-2"},"NOMOR ANTRIAN",-1)),o("div",oe,g(m.value?m.value.ticket_code:"A-000"),1)]),o("div",ne,[n[3]||(n[3]=o("span",{class:"text-[#00569c] text-2xl font-black uppercase mb-3"},"MENUJU",-1)),o("div",se,[n[2]||(n[2]=o("span",{class:"text-3xl font-bold tracking-widest uppercase mb-1"},"LOKET",-1)),o("span",le,g(m.value?(r=m.value.counter)==null?void 0:r.name.replace(/\D/g,""):"-"),1)])])]),o("div",re,[n[4]||(n[4]=o("div",{class:"bg-[#00569c] text-white py-3 px-6 text-center font-black uppercase tracking-[0.2em] text-sm"}," ANTRIAN BERIKUTNYA ",-1)),o("div",ie,[$.value.length>0?(h(!0),x(z,{key:0},U($.value,c=>{var v;return h(),x("div",{key:c.id,class:"flex-1 bg-white border-2 border-gray-200 rounded-2xl p-4 flex flex-col items-center justify-center shadow-md transform hover:scale-105 transition-transform"},[o("div",ce,g(c.ticket_code),1),o("div",de,g(((v=c.counter)==null?void 0:v.name)||"-"),1)])}),128)):(h(),x("div",ue," Belum ada antrian menunggu "))])])]),n[5]||(n[5]=o("div",{class:"w-[45%] p-6 pl-0 flex items-center"},[o("div",{class:"w-full h-full bg-black rounded-[30px] overflow-hidden shadow-2xl border-4 border-[#ffc107] relative"},[o("div",{id:"youtube-player",class:"w-full h-full scale-[1.3] pointer-events-none"}),o("div",{class:"absolute inset-0 bg-transparent z-10"})])],-1))]),u.value?O("",!0):(h(),x("div",pe,[o("div",fe,[o("div",me,[o("div",ve,[o("img",{src:"/images/logo-asabri.png",alt:"Logo",class:"h-24 w-auto object-contain",onError:n[0]||(n[0]=c=>c.target.style.display="none")},null,32)]),n[6]||(n[6]=o("h2",{class:"text-4xl font-black text-white mb-2 uppercase tracking-widest"},"SISTEM DISPLAY TV",-1)),n[7]||(n[7]=o("p",{class:"text-yellow-400 text-xl font-bold"},"PT ASABRI KC MALANG",-1))]),o("button",{onClick:M,class:"group relative inline-flex items-center justify-center px-16 py-6 text-2xl font-black text-[#00569c] transition-all duration-300 bg-yellow-400 font-sans rounded-full hover:scale-110 shadow-[0_0_50px_rgba(255,255,255,0.2)]"},[...n[8]||(n[8]=[o("svg",{class:"w-10 h-10 mr-4",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})],-1),o("span",null,"MULAI DISPLAY TV",-1)])])])]))]}),_:1}))}},be=J(ge,[["__scopeId","data-v-de338dd0"]]);export{be as default};
